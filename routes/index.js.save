
/*
 * GET home page.
 */

var redis = require('redis'), rc = redis.createClient();

rc.on('error', function (err) {
  console.log(err);
});

var i = 0;



exports.index = function(req, res){
  res.render('index', { title: 'Node.js BitTorrent Tracker' });
};

function hexEncode(str){
    var result = '', l=str.length, index=0;
    while (index<l){
        result += str.charCodeAt(index++).toString(16);
    }
    return result;
};

function urlDecode(str){
    str  =str.replace(new RegExp('\\+','g'),' ');
    return unescape(str);
};

exports.announce = function(req, res) {
  
  var info_hash = hexEncode(urlDecode(req.param('info_hash'))).toLowerCase();
  console.log(info_hash);
  var peer_id = hexEncode(urlDecode(req.param('peer_id'))).toLowerCase();
  console.log(peer_id);

  rc.lpush('peers:' + info_hash, i++);

  
//  console.log(req.get('info_hash'));
  res.end('/announce');
};

exports.scrape = function(req, res) {
//  console.log('/scrape');
//  console.log(req);
  res.end('/scrape');
};
